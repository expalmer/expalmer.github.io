<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
    
    <title>Criando um Rest com Slim Framework e Illuminate Database em poucos minutos - parte 1 | Palmer Oliveira. Juntos Aprendemos Mais!</title>
    

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="white" />

    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/rss.xml">

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />

    <meta name="author" content="@expalmer">
    <meta name="description" content="O Slim é um framework em PHP, ele é leve e muito útil, e nós usaremos o Illuminate Database que é um ORM inteligente.">
    <link rel="canonical" href="http://expalmer.github.io/criando-um-rest-com-slim-framework-e-illuminate-database-em-poucos-minutos-parte-1">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@expalmer">
    <meta name="twitter:domain" content="http://expalmer.github.io">
    <meta name="twitter:image:src" content="http://expalmer.github.io/images/palmer.jpg">
    <meta name="twitter:creator" content="@expalmer">
    <meta name="twitter:title" content="Criando um Rest com Slim Framework e Illuminate Database em poucos minutos - parte 1">
    <meta name="twitter:description" content="O Slim é um framework em PHP, ele é leve e muito útil, e nós usaremos o Illuminate Database que é um ORM inteligente.">

    <meta itemprop="name" content="Criando um Rest com Slim Framework e Illuminate Database em poucos minutos - parte 1">
    <meta itemprop="description" content="O Slim é um framework em PHP, ele é leve e muito útil, e nós usaremos o Illuminate Database que é um ORM inteligente.">
    <meta itemprop="image" content="http://expalmer.github.io/images/palmer.jpg">
    <meta itemprop="url" content="http://expalmer.github.io/criando-um-rest-com-slim-framework-e-illuminate-database-em-poucos-minutos-parte-1">
    <meta itemprop="author" content="@expalmer">
    <meta itemprop="inLanguage" content="pt-BR">
    <meta itemprop="keywords" content="PHP, SlimFramework, Illuminate">

    <meta property="og:locale" content="pt_BR">
    <meta property="og:type" content="article">
    <meta property="og:image" content="http://expalmer.github.io/images/palmer.jpg">
    <meta property="og:title" content="Criando um Rest com Slim Framework e Illuminate Database em poucos minutos - parte 1">
    <meta property="og:description" content="O Slim é um framework em PHP, ele é leve e muito útil, e nós usaremos o Illuminate Database que é um ORM inteligente.">
    <meta property="og:url" content="http://expalmer.github.io/criando-um-rest-com-slim-framework-e-illuminate-database-em-poucos-minutos-parte-1">
    <meta property="og:site_name" content="Criando um Rest com Slim Framework e Illuminate Database em poucos minutos - parte 1">

    <meta name="google-site-verification" content="BkRIiZn31VGZWd4NBpMhpA8pxdgnSOVwB0jaCFP800M" />

    <link rel="stylesheet" href="/styles/main.min.css">

    <link href="/favico.ico" rel="icon">

  </head>
  <body>
    <header class="header">
      <a href="http://expalmer.github.io" class="header__home" title="Blog do expalmer">
        <figure>
          <img src="http://expalmer.github.io/images/palmer.jpg" alt="Foto de um Panda de Óculos">
        </figure>
        <p>@expalmer</p>
      </a>
      <h1>A Javascript Enthusiast</h1>
      <h2>Juntos Aprendemos Mais :)</h2>
      <nav class="header__menu">
        <ul class="menu">
          <li><a href="http://expalmer.github.io" class="menu__link" title="Posts do Blog">Posts</a></li>
          <li><a href="http://expalmer.github.io/tags/" class="menu__link" title="Tags do Blog">Tags</a></li>
          <li><a href="https://github.com/expalmer" class="menu__link" title="Github do @expalmer">GitHub</a></li>
          <li><a href="http://expalmer.github.io/rss.xml" class="menu__link" title="RSS do Blog">RSS</a></li>
        </ul>
      </nav>
    </header>

    
  <main class="main">
    <div class="limiter">
      <article class="article" itemscope itemtype="https://schema.org/Blog">
        <header>
          <time class="post__time" itemprop="datePublished" content="November 22, 2014" datetime="November 22, 2014">November 22, 2014</time>
          <h1 class="post__title">Criando um Rest com Slim Framework em poucos minutos - parte 1</h1>
          <iside class="post__related">
            
            <a href="http://expalmer.github.io/tags/php" class="atag php" title="Veja mais posts sobre php">php</a>
            
            <a href="http://expalmer.github.io/tags/slimframework" class="atag slimframework" title="Veja mais posts sobre slimframework">slimframework</a>
            
          </iside>
        </header>
        <p>O <a href="http://slimframework.com/">Slim Framework</a> é um framework em PHP que uso praticamente em todos meus projetos em PHP, ele é leve e muito útil.</p>
<p>E juntamente com o Slim, eu uso o <a href="https://github.com/illuminate/database">Illuminate Database</a> que é um componente de ORM onde você não precisa gastar horas criando suas classes de banco de dados para consulta, relacionamento e tudo mais, ele abstrai toda essa parte.</p>
<p>Para ver o funcionamento do Slim, vamos criar uma API de cadastro de guitarras, só que neste post vamos primeiramente criar as rotas de leitura de nosso produto.</p>
<p>Nos posts seguintes, iremos criar o CRUD para deixar completo nosso Rest. Também veremos o funcionamento de um template engine e usaremos alguma lib javascript para fazer as ações no front-end.</p>
<h2 id="1-para-come-ar-criaremos-os-dados-">1) Para começar criaremos os dados!</h2>
<p>Crie 3 tabelas abaixo no MySql:</p>
<ul>
<li><strong>brands</strong>: Marca da guitarra.</li>
<li><strong>series</strong>: Modelo da Guitarra.</li>
<li><strong>guitars</strong>: A guitarra em sí, ela terá 2 chaves estrangeiras para ( <strong>brands</strong> e <strong>series</strong>).</li>
</ul>
<p>Alimente com esses dados:</p>
<pre><code class="lang-sql">
# brands
INSERT INTO brands (id, description, created_at, updated_at) VALUES
  (1, &#39;Gibson&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (2, &#39;Fender&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (3, &#39;Epiphone&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (4, &#39;PRS&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (5, &#39;Ibanez&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (6, &#39;Martin&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (7, &#39;Taylor&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

# series
INSERT INTO series (id, description, created_at, updated_at) VALUES
  (1, &#39;Les Paul&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (2, &#39;SG&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (3, &#39;RD&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (4, &#39;Flying V&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (5, &#39;Firebird&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (6, &#39;Statocaster&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (7, &#39;Telecaster&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (8, &#39;Jaguar&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (9, &#39;Custom&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (10, &#39;Retro&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (11, &#39;DX&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (12, &#39;HD-28&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

# guitars
# informamos brand, serie e um nome para a guitarra
INSERT INTO guitars (id, fk_brands, fk_series, description, created_at, updated_at) VALUES
  (1, 1, 1, &#39;Standart&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (2, 1, 2, &#39;Pro&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (3, 1, 3, &#39;Studio&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (4, 2, 6, &#39;Standart&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (5, 2, 7, &#39;Pro&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (6, 2, 8, &#39;Studio&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (7, 3, 1, &#39;Standart&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (8, 3, 2, &#39;Pro&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (9, 4, 9, &#39;Studio&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
  (10, 4, 9, &#39;Standart&#39;, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
</code></pre>
<h3 id="2-estrutura-de-arquivos-do-app">2 ) Estrutura de arquivos do APP</h3>
<pre><code class="lang-javascript">
slim-rest
├── app
│   ├── config
│   │   └── database.php
│   ├── controllers
│   │   └── appControllers.php
│   ├── helpers
│   │   └── appHelpers.php
│   ├── models
│   │   └── appModels.php
├── .htaccess
├── composer.json
└── index.php
</code></pre>
<p>Nós vamos instalar o Slim com o <a href="https://getcomposer.org/">Composer</a>, um gerenciador de dependências PHP. Se você não conhece ainda, essa é uma boa hora conhecer.</p>
<h3 id="3-composer-json">3) composer.json</h3>
<pre><code class="lang-javascript">{
  &quot;require&quot;: {
    &quot;slim/slim&quot;: &quot;2.4.3&quot;,
    &quot;illuminate/database&quot;: &quot;v4.2.9&quot;
  }
}
</code></pre>
<p>Vamos comentar as dependências.</p>
<ul>
<li><strong>slim/slim</strong>: Nosso framework.</li>
<li><strong>illuminate/database</strong>: Nosso ORM.</li>
</ul>
<h2 id="4-instalando-as-depend-ncias-com-composer-">4) Instalando as Dependências com Composer.</h2>
<p>Crie o diretório do nosso projeto que chamamos de <code>slim-rest</code> e dentro dela baixe o <code>composer</code> com o comando abaixo:</p>
<pre><code class="lang-bash">$ curl -sS https://getcomposer.org/installer | php
</code></pre>
<p>Esse comando vai baixar um arquivo chamado <code>composer.phar</code>, pois ele que vai fazer o trabalho de instalar suas dependências.</p>
<p>Ainda na raiz do diretório <code>slim-rest</code>, dê o comando para instalar as dependências.</p>
<pre><code class="lang-bash">$ php composer.phar install
</code></pre>
<p>O composer vai criar um diretório chamado <code>vendor</code> contendo todas as suas dependências.</p>
<p>Agora que baixou as dependências, vamos criar nossos arquivos.</p>
<h2 id="5-index-php">5) index.php</h2>
<p>Esse é nosso arquivo principal de entrada do APP.</p>
<pre><code class="lang-php">&lt;?php

# === constants
# ==================================================
define(&quot;_APP&quot;, dirname(__FILE__) . &#39;/app&#39;);

# === slim
# ==================================================
require &#39;vendor/autoload.php&#39;;
$app = new \Slim\Slim(array(
  &#39;debug&#39; =&gt; true
));

# === config
# ==================================================
require_once _APP . &#39;/config/database.php&#39;;

# === helpers
# ==================================================
require_once _APP . &#39;/helpers/appHelpers.php&#39;;

# === models
# ==================================================
require_once _APP . &quot;/models/appModels.php&quot;;

# === controllers
# ==================================================
require_once _APP . &quot;/controllers/appControllers.php&quot;;

# === run slim
$app-&gt;run();
</code></pre>
<h2 id="6-htaccess">6) .htaccess</h2>
<pre><code class="lang-bash">RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ index.php [QSA,L]
</code></pre>
<h2 id="7-app-config-database-php">7) app/config/database.php</h2>
<pre><code class="lang-php">
&lt;?php
// Database configuration
$settings = array(
  &#39;driver&#39;    =&gt; &#39;mysql&#39;,
  &#39;host&#39;      =&gt; &#39;localhost&#39;,
  &#39;database&#39;  =&gt; &#39;database&#39;,
  &#39;username&#39;  =&gt; &#39;user&#39;,
  &#39;password&#39;  =&gt; &#39;password&#39;,
  &#39;charset&#39;   =&gt; &#39;utf8&#39;,
  &#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
  &#39;prefix&#39;    =&gt; &#39;&#39;
);

use Illuminate\Database\Capsule\Manager as Capsule;
$capsule = new Capsule;
$capsule-&gt;addConnection( $settings );
$capsule-&gt;bootEloquent();
</code></pre>
<h2 id="8-app-helpers-apphelpers-php">8) app/helpers/appHelpers.php</h2>
<p>Aqui criei um helper para dar output em json.</p>
<pre><code class="lang-php">&lt;?php
use Slim\Slim;

class helpers {

  static function jsonResponse( $error = true, $message = &#39;&#39;, $data = array() ) {

    $app               = Slim::getInstance();
    $response          = new stdClass();
    $response-&gt;error   = $error;
    $response-&gt;message = $message;
    $response-&gt;data    = $data;

    $app-&gt;response()-&gt;header(&#39;Content-Type&#39;, &#39;application/json&#39;);
    return $app-&gt;response()-&gt;body( json_encode($response) );

  }

}
</code></pre>
<h2 id="9-app-models-appmodels-php">9) app/models/appModels.php</h2>
<p>Aqui é onde o <strong>Illuminate</strong> reconhece nossas classes de Model, apenas crie uma classe com extends nele, informe o nome da tabela e pronto. Cara, ele é muito útil e possui muitos outros recursos que fará você ganhar tempo em seus projetos.</p>
<p>Para saber como usar mais recursos do  <strong>Illuminate</strong>, olhe a documentação no <a href="http://laravel.com/docs/4.2/eloquent">site do Laravel</a>, pois ele usa esse component também.</p>
<pre><code class="lang-php">&lt;?php

class Brands extends Illuminate\Database\Eloquent\Model
{
  protected $table = &#39;brands&#39;;
}

class Series extends Illuminate\Database\Eloquent\Model
{
  protected $table = &#39;series&#39;;
}

class Guitars extends Illuminate\Database\Eloquent\Model
{
  protected $table = &#39;guitars&#39;;

  public function Brand() {
    return $this-&gt;hasOne(&#39;Brands&#39;,&#39;id&#39;, &#39;fk_brands&#39;);
  }

  public function Serie() {
    return $this-&gt;hasOne(&#39;Series&#39;,&#39;id&#39;, &#39;fk_series&#39;);
  }
}
</code></pre>
<h2 id="10-app-controllers-appcontrollers-php">10) app/controllers/appControllers.php</h2>
<pre><code class="lang-php">&lt;?php

# === api
# ==================================================
$app-&gt;get(&#39;/api/v1/brands&#39;, function() use ($app) {

  $results = Brands::all();
  return helpers::jsonResponse(false, &#39;results&#39;, $results );

});

$app-&gt;get(&#39;/api/v1/series&#39;, function() use ($app) {

  $results = Series::all();
  return helpers::jsonResponse(false, &#39;results&#39;, $results );

});

$app-&gt;get(&#39;/api/v1/guitars&#39;, function() use ($app) {

  $results = [];
  $description = $app-&gt;request-&gt;get(&#39;description&#39;);
  if ( $description ) {
    $results = Guitars::with(&#39;Brand&#39;)
                      -&gt;with(&#39;Serie&#39;)
                      -&gt;where(&#39;description&#39;,&#39;LIKE&#39;,&quot;%{$description}%&quot;)
                      -&gt;get();
  } else {
    $results = Guitars::with(&#39;Brand&#39;)
                      -&gt;with(&#39;Serie&#39;)
                      -&gt;get();
  }
  $message = $results-&gt;count() . &#39; results&#39;;
  return helpers::jsonResponse(false, $message, $results );

});
</code></pre>
<p>Pronto!!!</p>
<p>Agora abra seu browser no endereço do seu APP, no meu caso é <code>http://localhost/slim-rest/</code>, então as rotas ficaram assim:</p>
<ul>
<li><code>http://localhost/slim-rest/api/v1/brands</code>: As marcas.</li>
<li><code>http://localhost/slim-rest/api/v1/series</code>: Os modelos.</li>
<li><code>http://localhost/slim-rest/api/v1/guitars</code>: As guitarras com sua respectiva marca e modelo.</li>
</ul>
<p>Temos também uma pequena busca no campo <code>description</code> na rota guitars, testa assim: <code>http://localhost/slim-rest/api/v1/guitars?description=a</code>.</p>
<p>Então isso é só o começo, podemos criar muitas coisas em cima disso.</p>
<p>Não expliquei detalhadamente cada arquivo, mas se você tiver alguma dúvida pode me perguntar que terei o prazer em ajuda-lo. Caso tenha alguma dica de melhoria, será bem vinda!</p>
<p>Concluindo, o <code>Slim</code> é muito bacana pois em minutos você levanta uma aplicação bem organizada, rápida e segura. Note que usamos o <code>Illuminate</code> para pegar os dados do banco, inclusive com join e outras tabelas, e tudo isso de uma forma simples.</p>
<p>Com pouco código já temos nosso Rest definido!</p>
<p>Obrigado por ler, e até o próximo post.</p>
<p>That&#39;s it!</p>

      </article>
      <!-- COMMENTS -->
      <section id="comments">
        <div id="disqus_thread"></div>
        <script data-cfasync="true" type="text/javascript">
            var disqus_shortname = 'expalmer';
            var disqus_url = 'http://expalmer.github.io/criando-um-rest-com-slim-framework-e-illuminate-database-em-poucos-minutos-parte-1/';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </section>
    </div>
  </main>


    <footer class="footer">
      <p>Made with <a href="http://www.metalsmith.io/" title="Metalsmith">Metalsmith</a>. View <a href="https://github.com/expalmer/expalmer.github.io-files" title="Source">Source</a></p>
    </footer>
    <script src="/scripts/main.min.js"></script>
  </body>
</html>